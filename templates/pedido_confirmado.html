<!--
    TEMPLATE PEDIDO CONFIRMADO - pedido_confirmado.html
    ==================================================
    
    Página exibida após a finalização do pedido, com link para WhatsApp
    
    Conceitos abordados:
    - Feedback de sucesso
    - Link do WhatsApp gerado dinamicamente
    - Informações do pedido
    - Call-to-action claro
    - Próximos passos
-->

{% extends "base.html" %}

{% block title %}Pedido Confirmado - Adega Rádio Tatuapé FM{% endblock %}

{% block content %}
<div class="container">
    <!-- CABEÇALHO DE SUCESSO -->
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="text-center mb-4">
                <!-- Ícone de sucesso grande -->
                <div class="mb-4">
                    <i class="fas fa-check-circle text-success" style="font-size: 5rem;"></i>
                </div>
                
                <h1 class="text-success mb-3">
                    <i class="fas fa-thumbs-up me-2"></i>
                    Pedido Confirmado!
                </h1>
                
                <p class="lead text-muted">
                    Seu pedido foi processado com sucesso. 
                    Agora vamos enviá-lo via WhatsApp para finalizar a entrega!
                </p>
            </div>
        </div>
    </div>
    
    <!-- CARD PRINCIPAL -->
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <div class="card shadow-lg border-success">
                <div class="card-header bg-success text-white text-center">
                    <h4 class="mb-0">
                        <i class="fas fa-receipt me-2"></i>
                        Pedido #{{ pedido.id }}
                    </h4>
                    <small>Criado em {{ pedido.data_pedido.strftime('%d/%m/%Y às %H:%M') }}</small>
                </div>
                
                <div class="card-body">
                    <!-- INFORMAÇÕES DO CLIENTE -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <h6 class="text-muted mb-2">
                                <i class="fas fa-user me-2"></i>
                                Dados do Cliente
                            </h6>
                            <p class="mb-1"><strong>Nome:</strong> {{ pedido.nome_cliente }}</p>
                            <p class="mb-1"><strong>Telefone:</strong> {{ pedido.telefone_cliente }}</p>
                        </div>
                        
                        <div class="col-md-6">
                            <h6 class="text-muted mb-2">
                                <i class="fas fa-map-marker-alt me-2"></i>
                                Endereço de Entrega
                            </h6>
                            <p class="mb-1">{{ pedido.endereco_cliente }}</p>
                        </div>
                    </div>
                    
                    <!-- OBSERVAÇÕES (se houver) -->
                    {% if pedido.observacoes %}
                    <div class="row mb-4">
                        <div class="col-12">
                            <h6 class="text-muted mb-2">
                                <i class="fas fa-comment me-2"></i>
                                Observações
                            </h6>
                            <div class="bg-light p-3 rounded">
                                <em>{{ pedido.observacoes }}</em>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    
                    <!-- RESUMO FINANCEIRO -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <div class="bg-light p-4 rounded">
                                <div class="d-flex justify-content-between align-items-center">
                                    <span class="h5 mb-0">
                                        <i class="fas fa-calculator me-2 text-primary"></i>
                                        Valor Total do Pedido:
                                    </span>
                                    <span class="h3 text-success mb-0 fw-bold">
                                        {{ pedido.valor_total|currency }}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- PRÓXIMOS PASSOS -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h6 class="text-muted mb-3">
                                <i class="fas fa-list-ol me-2"></i>
                                Próximos Passos
                            </h6>
                            
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="d-flex align-items-start mb-3">
                                        <div class="flex-shrink-0">
                                            <div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                                                <strong>1</strong>
                                            </div>
                                        </div>
                                        <div class="flex-grow-1 ms-3">
                                            <h6 class="mb-1">Enviar via WhatsApp</h6>
                                            <small class="text-muted">
                                                Clique no botão abaixo para abrir o WhatsApp
                                            </small>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-4">
                                    <div class="d-flex align-items-start mb-3">
                                        <div class="flex-shrink-0">
                                            <div class="bg-warning text-dark rounded-circle d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                                                <strong>2</strong>
                                            </div>
                                        </div>
                                        <div class="flex-grow-1 ms-3">
                                            <h6 class="mb-1">Fazer Pagamento PIX</h6>
                                            <small class="text-muted">
                                                Use: <strong>radiotatuapefm@gmail.com</strong>
                                            </small>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-4">
                                    <div class="d-flex align-items-start mb-3">
                                        <div class="flex-shrink-0">
                                            <div class="bg-success text-white rounded-circle d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                                                <strong>3</strong>
                                            </div>
                                        </div>
                                        <div class="flex-grow-1 ms-3">
                                            <h6 class="mb-1">Enviar Comprovante</h6>
                                            <small class="text-muted">
                                                Envie foto do comprovante no mesmo chat
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- RODAPÉ COM AÇÕES -->
                <div class="card-footer bg-light">
                    <div class="row align-items-center">
                        <div class="col-md-6">
                            <!-- Informações de pagamento PIX -->
                            <div class="d-flex align-items-center">
                                <i class="fas fa-money-bill-wave text-success fa-2x me-3"></i>
                                <div>
                                    <h6 class="mb-0">Chave PIX</h6>
                                    <div class="d-flex align-items-center">
                                        <code class="bg-white px-2 py-1 rounded border">radiotatuapefm@gmail.com</code>
                                        <button class="btn btn-sm btn-outline-secondary ms-2" onclick="copiarChavePix()">
                                            <i class="fas fa-copy"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6 text-md-end mt-3 mt-md-0">
                            <!-- Botão principal - WhatsApp -->
                            <a href="{{ whatsapp_url }}" 
                               class="btn btn-success btn-lg me-2"
                               target="_blank"
                               rel="noopener"
                               onclick="trackWhatsAppClick()">
                                <i class="fab fa-whatsapp me-2"></i>
                                Abrir WhatsApp
                            </a>
                            
                            <!-- Botão secundário - Voltar ao início -->
                            <a href="{{ url_for('index') }}" class="btn btn-outline-primary">
                                <i class="fas fa-home me-2"></i>
                                Novo Pedido
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- SEÇÃO DE DICAS/INFORMAÇÕES ADICIONAIS -->
    <div class="row justify-content-center mt-5">
        <div class="col-lg-10">
            <div class="row">
                <!-- Dicas de pagamento -->
                <div class="col-md-4">
                    <div class="card border-info">
                        <div class="card-body text-center">
                            <i class="fas fa-mobile-alt text-info fa-2x mb-3"></i>
                            <h6>Pagamento PIX</h6>
                            <p class="small text-muted mb-0">
                                Use qualquer app bancário para fazer o PIX. 
                                É rápido, seguro e instantâneo!
                            </p>
                        </div>
                    </div>
                </div>
                
                <!-- Dicas de entrega -->
                <div class="col-md-4">
                    <div class="card border-warning">
                        <div class="card-body text-center">
                            <i class="fas fa-truck text-warning fa-2x mb-3"></i>
                            <h6>Tempo de Entrega</h6>
                            <p class="small text-muted mb-0">
                                O prazo será confirmado via WhatsApp após o pagamento. 
                                Trabalhamos 24 horas!
                            </p>
                        </div>
                    </div>
                </div>
                
                <!-- Dicas de contato -->
                <div class="col-md-4">
                    <div class="card border-success">
                        <div class="card-body text-center">
                            <i class="fas fa-headset text-success fa-2x mb-3"></i>
                            <h6>Atendimento</h6>
                            <p class="small text-muted mb-0">
                                Dúvidas? Entre em contato pelo WhatsApp: 
                                <strong>(11) 97060-3441</strong>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- FOOTER COM AGRADECIMENTO -->
    <div class="row justify-content-center mt-5">
        <div class="col-lg-8 text-center">
            <div class="bg-light p-4 rounded">
                <h5 class="text-success mb-3">
                    <i class="fas fa-heart me-2"></i>
                    Obrigado pela Preferência!
                </h5>
                <p class="text-muted mb-0">
                    <strong>Adega Rádio Tatuapé FM</strong> - Sua adega 24 horas de confiança!<br>
                    Produtos sempre gelados, entrega rápida e atendimento de qualidade.
                </p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

<!-- SCRIPTS ESPECÍFICOS DA CONFIRMAÇÃO -->
{% block extra_scripts %}
<script>
    // JavaScript para funcionalidades da página de confirmação
    // =======================================================
    
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Página de confirmação carregada - Pedido #{{ pedido.id }}');
        
        // Configurar temporizador para redirecionar se não clicar no WhatsApp
        // setupAutoRedirect();
        
        // Mostrar notificação de sucesso
        showSuccessMessage();
    });
    
    function copiarChavePix() {
        // Copia a chave PIX para o clipboard
        const chave = 'radiotatuapefm@gmail.com';
        
        // Método moderno
        if (navigator.clipboard) {
            navigator.clipboard.writeText(chave).then(function() {
                showToast('Chave PIX copiada com sucesso!', 'success');
                
                // Feedback visual no botão
                const botao = event.target.closest('button');
                const iconOriginal = botao.innerHTML;
                botao.innerHTML = '<i class="fas fa-check text-success"></i>';
                
                setTimeout(() => {
                    botao.innerHTML = iconOriginal;
                }, 2000);
                
            }).catch(function() {
                // Fallback para método antigo
                copyFallback(chave);
            });
        } else {
            // Fallback para navegadores antigos
            copyFallback(chave);
        }
    }
    
    function copyFallback(text) {
        // Método alternativo para copiar texto
        const textArea = document.createElement('textarea');
        textArea.value = text;
        textArea.style.position = 'fixed';
        textArea.style.left = '-999999px';
        textArea.style.top = '-999999px';
        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();
        
        try {
            document.execCommand('copy');
            showToast('Chave PIX copiada!', 'success');
        } catch (err) {
            showToast('Erro ao copiar. Chave PIX: radiotatuapefm@gmail.com', 'error');
        } finally {
            textArea.remove();
        }
    }
    
    function trackWhatsAppClick() {
        // Rastreia clique no botão do WhatsApp
        console.log('Usuário clicou no botão do WhatsApp - Pedido #{{ pedido.id }}');
        
        // Aqui você poderia enviar dados para Google Analytics ou similar
        if (typeof gtag !== 'undefined') {
            gtag('event', 'whatsapp_click', {
                'pedido_id': '{{ pedido.id }}',
                'valor_total': {{ pedido.valor_total }}
            });
        }
        
        showToast('Abrindo WhatsApp...', 'info');
    }
    
    function showSuccessMessage() {
        // Mostra mensagem de sucesso personalizada
        setTimeout(() => {
            showToast('Pedido #{{ pedido.id }} criado com sucesso! Agora clique em "Abrir WhatsApp".', 'success');
        }, 1000);
    }
    
    function setupAutoRedirect() {
        // Redireciona automaticamente após um tempo (opcional)
        // Descomentado por enquanto - pode ser útil no futuro
        /*
        setTimeout(() => {
            if (confirm('Deseja ser redirecionado para fazer um novo pedido?')) {
                window.location.href = '{{ url_for("index") }}';
            }
        }, 300000); // 5 minutos
        */
    }
    
    // Função para mostrar notificações toast
    function showToast(message, type = 'info') {
        const toastContainer = getOrCreateToastContainer();
        
        const toast = document.createElement('div');
        toast.className = `alert alert-${type === 'success' ? 'success' : type === 'error' ? 'danger' : 'info'} alert-dismissible fade show`;
        toast.style.cssText = 'margin-bottom: 10px;';
        toast.innerHTML = `
            <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-triangle' : 'info-circle'} me-2"></i>
            ${message}
            <button type="button" class="btn-close" onclick="this.parentElement.remove()"></button>
        `;
        
        toastContainer.appendChild(toast);
        
        // Remove automaticamente após 5 segundos
        setTimeout(() => {
            if (toast.parentNode) {
                toast.remove();
            }
        }, 5000);
    }
    
    function getOrCreateToastContainer() {
        // Cria ou obtém container para toasts
        let container = document.getElementById('toast-container');
        
        if (!container) {
            container = document.createElement('div');
            container.id = 'toast-container';
            container.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 1050;
                max-width: 350px;
            `;
            document.body.appendChild(container);
        }
        
        return container;
    }
    
    // Previne que o usuário saia da página acidentalmente
    window.addEventListener('beforeunload', function(e) {
        // Só mostra aviso se ainda não clicou no WhatsApp
        const whatsappClicked = localStorage.getItem('whatsapp_clicked_{{ pedido.id }}');
        
        if (!whatsappClicked) {
            const message = 'Tem certeza que deseja sair? Não esqueça de enviar seu pedido via WhatsApp!';
            e.returnValue = message;
            return message;
        }
    });
    
    // Marca quando o usuário clica no WhatsApp
    document.querySelector('a[href*="wa.me"]').addEventListener('click', function() {
        localStorage.setItem('whatsapp_clicked_{{ pedido.id }}', 'true');
        
        // Remove o aviso de saída após 30 segundos
        setTimeout(() => {
            localStorage.removeItem('whatsapp_clicked_{{ pedido.id }}');
        }, 30000);
    });
</script>

<!-- Schema.org structured data para SEO -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Order",
  "orderNumber": "{{ pedido.id }}",
  "orderDate": "{{ pedido.data_pedido.isoformat() }}",
  "orderStatus": "https://schema.org/OrderProcessing",
  "customer": {
    "@type": "Person",
    "name": "{{ pedido.nome_cliente }}",
    "telephone": "{{ pedido.telefone_cliente }}"
  },
  "seller": {
    "@type": "Organization",
    "name": "Adega Rádio Tatuapé FM",
    "telephone": "+5511970603441",
    "email": "radiotatuapefm@gmail.com"
  },
  "totalPrice": "{{ pedido.valor_total }}",
  "priceCurrency": "BRL"
}
</script>
{% endblock %}
